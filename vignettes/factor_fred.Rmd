---
title: "Factor model using the FRED-MD data set"
author: "Yankang Bennie Chen"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{factor_fred}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:



# Import data

```{r}
library(fbi)
library(DT)

data <- fredmd(date_start = NULL, date_end = NULL, transform = TRUE)
N <- ncol(data)

# View the head lines of data
DT::datatable(data, options = list(scrollX = TRUE, pageLength = 5))
```



## Check for outliers

```{r}
data_clean <- rm_outliers.fredmd(data)
```


# Factor Model
```{r}
col_na_prop <- apply(is.na(data_clean), 2, mean)
data_select <- data_clean[, (col_na_prop < 0.05)]
data_bal <- na.omit(data_select)
X_bal <- data_bal[,2:ncol(data_bal)]
rownames(X_bal) <- data_bal[,1]

# View balanced data
datatable(X_bal, options = list(scrollX = TRUE, pageLength = 3))

# Run rpca
library(fbi)
out <- rpca(X_bal, kmax = 8, standardize = FALSE, tau = 0)
```


## Estimates for F, Lambda, C

```{r}
datatable(out$Fhat, options = list(scrollY = TRUE, pageLength = 5))
datatable(out$Lamhat, options = list(scrollY = TRUE, pageLength = 5))
datatable(out$Chat, options = list(scrollY = TRUE, pageLength = 5))
```

## Standard Error of C^hat

```{r}
xpt <- list(c(1,2,3,4), c(2,3,4,5), c(3,4,5,6), c(4,5,6,7))

se.rpca(object = out, xpoints = xpt, qq = 50)
```

